HW 6
================
Julia Gray
2025-11-17

## Problem 1

Get data:

``` r
homicide_df = read.csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv") |> 
  janitor::clean_names() |> 
  mutate(
    reported_date = as.Date(as.character(reported_date), format = "%y%m%d"),
    city_state = paste(city, state, sep=", "),
    solved = as.numeric(disposition %in% c("Closed by arrest")),
    victim_age = as.numeric(victim_age),
    victim_race = fct_relevel(victim_race, "White")
  ) |> 
  filter(
    !city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL"),
    !victim_age %in% c(NA),    #remove age is NA
    victim_race %in% c("White", "Black")
  )
```

    ## Warning: There was 1 warning in `mutate()`.
    ## ℹ In argument: `victim_age = as.numeric(victim_age)`.
    ## Caused by warning:
    ## ! NAs introduced by coercion

``` r
baltimore_df = homicide_df |> 
  filter(
    city_state == "Baltimore, MD"
  ) |> 
  select(solved, victim_age, victim_race, victim_sex)
```

Fit model for Baltimore:

``` r
or_balt = 
  baltimore_df |> 
  glm(solved ~ victim_age + victim_race + victim_sex, data = _, family = binomial()) 

or_balt |> 
  broom::tidy(conf.int = TRUE, exponentiate = TRUE) |> 
  select(term, estimate, conf.low, conf.high, p.value) |> 
  knitr::kable(digits = 3)
```

| term             | estimate | conf.low | conf.high | p.value |
|:-----------------|---------:|---------:|----------:|--------:|
| (Intercept)      |    3.164 |    1.998 |     5.057 |   0.000 |
| victim_age       |    0.993 |    0.987 |     1.000 |   0.043 |
| victim_raceBlack |    0.431 |    0.305 |     0.606 |   0.000 |
| victim_sexMale   |    0.426 |    0.324 |     0.558 |   0.000 |

Fit model for all cities:

``` r
fit_or = function(input_city){
  
  fit = 
    homicide_df |>
    filter(city_state == input_city) |>
    glm(formula = solved ~ victim_age + victim_race + victim_sex, data = _, family = binomial()) |>
    broom::tidy(conf.int = TRUE, exponentiate = TRUE) |>
    filter(term == "victim_sexMale") |>
    select(estimate, conf.low, conf.high, p.value)

  fit
}

ny_test = fit_or('New York, NY')

or_all_cities = 
  tibble(
    city_s = unique(pull(homicide_df, city_state))
    ) |> 
  mutate(fit_estimates = map(city_s, fit_or)) |> 
  unnest(fit_estimates)
```

    ## Warning: There were 44 warnings in `mutate()`.
    ## The first warning was:
    ## ℹ In argument: `fit_estimates = map(city_s, fit_or)`.
    ## Caused by warning:
    ## ! glm.fit: fitted probabilities numerically 0 or 1 occurred
    ## ℹ Run `dplyr::last_dplyr_warnings()` to see the 43 remaining warnings.

Plot the results

``` r
or_all_cities |> 
  mutate(city_s = fct_reorder(city_s, estimate)) |> 
  ggplot(aes(x = estimate, y = city_s)) + 
  geom_point() + 
  geom_errorbar(aes(xmin = conf.low, xmax = conf.high)) +
  geom_vline(xintercept = 1, color = "red") +
  xlim(0, 4) +
  ylab("City, State") +
  xlab("OR of homicide being solved (male vs. female)")
```

<img src="p9105_hw6_jg5038_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

An odds ratio of 1 (shown on the plot as a red line), means there is no
difference in the odss of the homicide being solved between males and
females. An odds ratio greater than 1 means that homicides where the
victim is male have higher odds of being solved and vice versa. The
confidence interval is shown by the error bars and where it crosses 1
the results are not significant.
